<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Re: [請益] PHP怎麼寫樹狀清單 - 看板 PHP - 批踢踢實業坊</title>
<meta name="robots" content="all">
<meta name="keywords" content="Ptt BBS 批踢踢">
<meta name="description" content="先把規格開出來, 包括樹狀結構的資料表規劃, 例如:
資料表 - 選單項目:
tree_items: id, name, parent_id, note
id: 選單項目的主鍵
name: 選單項目的名稱
">
<meta property="og:site_name" content="Ptt 批踢踢實業坊">
<meta property="og:title" content="Re: [請益] PHP怎麼寫樹狀清單">
<meta property="og:description" content="先把規格開出來, 包括樹狀結構的資料表規劃, 例如:
資料表 - 選單項目:
tree_items: id, name, parent_id, note
id: 選單項目的主鍵
name: 選單項目的名稱
">
<link rel="canonical" href="https://www.ptt.cc/bbs/PHP/M.1259890163.A.239.html">

<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-common.css">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-custom.css">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/pushstream.css" media="screen">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-print.css" media="print">




	<script async src='/cdn-cgi/challenge-platform/h/g/scripts/invisible.js?ts=1653465600'></script></head>
    <body>
		
<div id="topbar-container">
	<div id="topbar" class="bbs-content">
		<a id="logo" href="/bbs/">批踢踢實業坊</a>
		<span>&rsaquo;</span>
		<a class="board" href="/bbs/PHP/index.html"><span class="board-label">看板 </span>PHP</a>
		<a class="right small" href="/about.html">關於我們</a>
		<a class="right small" href="/contact.html">聯絡資訊</a>
	</div>
</div>
<div id="navigation-container">
	<div id="navigation" class="bbs-content">
		<a class="board" href="/bbs/PHP/index.html">返回看板</a>
		<div class="bar"></div>
	</div>
</div>
<div id="main-container">
    <div id="main-content" class="bbs-screen bbs-content"><div class="article-metaline"><span class="article-meta-tag">作者</span><span class="article-meta-value">bobju (寶貝豬)</span></div><div class="article-metaline-right"><span class="article-meta-tag">看板</span><span class="article-meta-value">PHP</span></div><div class="article-metaline"><span class="article-meta-tag">標題</span><span class="article-meta-value">Re: [請益] PHP怎麼寫樹狀清單</span></div><div class="article-metaline"><span class="article-meta-tag">時間</span><span class="article-meta-value">Fri Dec  4 09:29:19 2009</span></div>
<span class="f2">※ 引述《wallsem (小樂)》之銘言：
</span><span class="f6">:         最近想用php寫樹狀清單
</span><span class="f6">:         想問一下~要怎麼寫?!
</span><span class="f6">:         我要資料庫新增，目錄或子目錄就會增加...
</span><span class="f6">:         一定要用迴圈才可以嗎~~
</span><span class="f6">:         有沒有其他的方法!!
</span>
先把規格開出來, 包括樹狀結構的資料表規劃, 例如:

資料表 - 選單項目:
tree_items: id, name, parent_id, note

id: 選單項目的主鍵
name: 選單項目的名稱
parent_id: 父層的id
note: 關於這個選單項目的描述

存取選單項目資料表的函式:

1 新增一項選單項目
  function tree_items_add(name,parent_id,note)

2 從資料庫中取出整個[選單項目集],
  function &amp;db2items()

3 將[選單項目集]所有記錄的 id 及其 parent_id 的關聯
  轉成[php array tree]的結構,
  function &amp;items2tree($items)

4 製作[php array tree]的view, 例如以樹狀表達形式呈現在網頁上.
  function tree2view($tree,&amp;$items)

上述 1 的實作省略, 就是利用sql的insert語法插入資料而已. 如果是第一
個節點(根節點), 則其 parent_id 設為 0.

補充說明一下: 為了跟以下的架構相呼應, 一個tree的根節點只能有一個,
意即tree_items裏 parent_id 為 0 的記錄只能有一筆.

除了新增以外, 其它資料管理功能還有檢視, 修改, 刪除, 查詢等就依實際
需求自訂.

至於 2, 3, 4 需要提一下. 網路上應該找得出現成的code, 可能php的官網
的範例就有. 不過自己刻當做是練功也可(一開始可能得花不少時間試誤).

php array tree的結構是這樣子的:
$tree = array(
 &#39;1&#39; =&gt; array(
  &#39;2&#39; =&gt; array(
   &#39;3&#39; =&gt; array(
    &#39;4&#39; =&gt; array()
   )
  ),
  &#39;5&#39; =&gt; array(
   &#39;6&#39; =&gt; array(),
   &#39;7&#39; =&gt; array()
  )
 )
);

樹狀表達形式 - text形式:
1
 2
  3
   4
 5
  6
  7


假設選單項目的資料都建好了, 接著要呈現在網頁上的程式架構大致上是:
&lt;?php

 //載入系統組態檔, 在此主要是定義資料庫連線物件變數, 需要自備:
 include &#39;configure.inc.php&#39;;

 //從資料庫中取出整個[選單項目集],
 $items = db2items();

 //將[選單項目集]所有記錄的 id 及其 parent_id 的關聯
 //轉成[php array tree]的結構,
 $tree = items2tree($items);

 //製作[php array tree]的view, 例如以樹狀表達形式呈現在網頁上.
 $html = tree2view($tree,$items);

 echo $html;

?&gt;

接著以下是程式碼, 是從既有已驗證過可執行的函式庫抓出來的. 但在這篇文章
中為了需要稍有改一些細項, 未經實際測試, 不確定是否能run得起來, 僅供參考.

&lt;?php
//從資料庫中取出整個[選單項目集]
function &amp;db2items(){

 //資料庫連線的物件變數, 假設在系統組態檔裏已完成初始化.
 //這裏直接以global方式引用. 不然在本函式內自訂亦可.
 global $DB_link;

 //先把 tree_items 全部抓出來
 $sql = &#34;select * from tree_items&#34;;
 $rows = mysql_query($sql,$DB_link);

 $items=array();
 while ( $row = mysql_fetch_assoc($rows) ){
  $items[$row[&#39;id&#39;]]=$row;
 }

 return $items;

}

//將[選單項目集]記錄轉成[php array tree]的結構
function &amp;items2tree($items){

 //再把 $items 當中所有item的 id及parent_id 轉成 php array tree
 $tree=array();

 //$reftab用來記錄item在tree裏位置的reference.
 $reftab=array();

 foreach($items as $key =&gt; $row) {

  $pkey=$row[&#39;parent_id&#39;];

  if($pkey==0) { //代表這是根節點
   $tree[$key]=array();
   $reftab[$key]=&amp;$tree[$key];

  }

  else { //代表這是一般節點

   if(!isset($reftab[$pkey])){
    $reftab[$pkey]=array();
   }

   if(!isset($reftab[$key])){
    $reftab[$key]=array();
   }

   $reftab[$pkey][$key]=&amp;$reftab[$key];

  }

 return $tree;

}

//製作[php array tree]的view, 例如以樹狀表達形式呈現在網頁上
//這裏僅以簡單的文字形式表示. 若有實際應用上的需求, 亦可自訂
//套用 html, 或是 javascript等樣板來達到目的.
function tree2view($tree,&amp;$items){

 $text=&#39;&#39;;

 _php2text($text,$tree,0,$items);

 return $text;

}

//以遞迴方式呈現php array tree
//$Depth代表樹狀結構的深度, 0代表根層. 輸出結果以空格代表層數.
function _php2text(&amp;$text,$tree,$Depth,&amp;$items) {

 if(!$tree) return;

 foreach($tree as $k=&gt;$v) {

  $blanks=&#39;&#39;;
  for($i=0;$i&lt;$Depth;$i++)
   $blanks.=&#39; &#39;;

  $text.=$blanks.$items[$k][&#39;name&#39;].&#34;\r\n&#34;;

  //遞迴呼叫:
  _php2text($text,$v,$Depth+1,$items);

 }

}
?&gt;
<span class="f2">※ 編輯: bobju           來自: 58.115.151.184       (12/04 09:41)
</span><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">bobju</span><span class="f3 push-content">:關於樹狀資料結構的資料表設計,進階的有MPTT,google找就有.</span><span class="push-ipdatetime"> 12/04 10:19
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">bobju</span><span class="f3 push-content">:不過要弄懂MPTT得有些資料結構跟演算法的基礎,否則看嘸.</span><span class="push-ipdatetime"> 12/04 10:19
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">bobju</span><span class="f3 push-content">:MPTT: Modified Preorder Tree Traversal</span><span class="push-ipdatetime"> 12/04 10:20
</span></div><span class="f2">※ 編輯: bobju           來自: 58.115.151.184       (12/04 11:44)
</span><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">world294</span><span class="f3 push-content">:<a href="http://0rz.tw/TRFow" target="_blank" rel="noreferrer noopener nofollow">http://0rz.tw/TRFow</a>  我之前有看過這個</span><span class="push-ipdatetime"> 12/07 18:26
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">josch</span><span class="f3 push-content">:try this <a href="http://0rz.tw/4ETMH" target="_blank" rel="noreferrer noopener nofollow">http://0rz.tw/4ETMH</a></span><span class="push-ipdatetime"> 12/11 11:49
</span></div></div>
    
    <div id="article-polling" data-pollurl="/poll/PHP/M.1259890163.A.239.html?cacheKey=2148-469795348&amp;offset=4432&amp;offset-sig=8f6a76c978a62680604fbd93ea81d2179a88fdc6" data-longpollurl="/v1/longpoll?id=83af6a76781115572637122575e8a694e40aa58e" data-offset="4432"></div>
    

    
</div>

		

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32365737-1', {
    cookieDomain: 'ptt.cc',
    legacyCookieDomain: 'ptt.cc'
  });
  ga('send', 'pageview');
</script>


		
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//images.ptt.cc/bbs/v2.27/bbs.js"></script>

    <script type="text/javascript">(function(){window['__CF$cv$params']={r:'710cea4dce15af60',m:'gw7pGcpquThJN7HdtlzKBRA5yqkYHkOPpfvVWuO6j7U-1653467491-0-AamJhwHFAGxAZiUbvcD8NQDtQCr2Apzul5cWfG+byZwvpx2Ny/AIHKyYPh8rATz86m5HQH6aQgJhY0b4jXnQYZeDsN/KuoVGy8qE3/sQhKqiHRs4BxAj9oulS6YJcRvsMb2H5Q/96hAUgc1nFDdXwdQdb/zHo9n6N5tjUfdpSfUq',s:[0xd35194d0ea,0xc404244c0d],u:'/cdn-cgi/challenge-platform/h/g'}})();</script></body>
</html>

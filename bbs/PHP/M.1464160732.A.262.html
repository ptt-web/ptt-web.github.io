<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		

<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Re: [請益] PHP驗證帳號的方式 - 看板 PHP - 批踢踢實業坊</title>
<meta name="robots" content="all">
<meta name="keywords" content="Ptt BBS 批踢踢">
<meta name="description" content="簡單的答案：
別管 cookie，跟他分手，不要用它。
程式開始前先呼叫 session_start()，然後把資料都存進 $_SESSION，不要存 cookie。
登出的時候記得把 $_SESSION 裡面對應的參數全部清掉。
-----------------------------------------------
">
<meta property="og:site_name" content="Ptt 批踢踢實業坊">
<meta property="og:title" content="Re: [請益] PHP驗證帳號的方式">
<meta property="og:description" content="簡單的答案：
別管 cookie，跟他分手，不要用它。
程式開始前先呼叫 session_start()，然後把資料都存進 $_SESSION，不要存 cookie。
登出的時候記得把 $_SESSION 裡面對應的參數全部清掉。
-----------------------------------------------
">
<link rel="canonical" href="https://www.ptt.cc/bbs/PHP/M.1464160732.A.262.html">

<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-common.css">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-custom.css">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/pushstream.css" media="screen">
<link rel="stylesheet" type="text/css" href="//images.ptt.cc/bbs/v2.27/bbs-print.css" media="print">




	<script async src='/cdn-cgi/challenge-platform/h/g/scripts/invisible.js?ts=1653465600'></script></head>
    <body>
		
<div id="topbar-container">
	<div id="topbar" class="bbs-content">
		<a id="logo" href="/bbs/">批踢踢實業坊</a>
		<span>&rsaquo;</span>
		<a class="board" href="/bbs/PHP/index.html"><span class="board-label">看板 </span>PHP</a>
		<a class="right small" href="/about.html">關於我們</a>
		<a class="right small" href="/contact.html">聯絡資訊</a>
	</div>
</div>
<div id="navigation-container">
	<div id="navigation" class="bbs-content">
		<a class="board" href="/bbs/PHP/index.html">返回看板</a>
		<div class="bar"></div>
	</div>
</div>
<div id="main-container">
    <div id="main-content" class="bbs-screen bbs-content"><div class="article-metaline"><span class="article-meta-tag">作者</span><span class="article-meta-value">GALINE (天真可愛CQD)</span></div><div class="article-metaline-right"><span class="article-meta-tag">看板</span><span class="article-meta-value">PHP</span></div><div class="article-metaline"><span class="article-meta-tag">標題</span><span class="article-meta-value">Re: [請益] PHP驗證帳號的方式</span></div><div class="article-metaline"><span class="article-meta-tag">時間</span><span class="article-meta-value">Wed May 25 15:18:49 2016</span></div>
<span class="f6">&gt; 推 GALINE: 不要把登入/帳號資訊放在 cookie 裡面，只存session id
</span><span class="f6">&gt; → GALINE: 登入後的權限放在session裡面不讓client碰
</span><span class="f6">&gt; session id該怎麼寫QQ 有教學嗎?
</span>
簡單的答案：

別管 cookie，跟他分手，不要用它。

程式開始前先呼叫 session_start()，然後把資料都存進 $_SESSION，不要存 cookie。
登出的時候記得把 $_SESSION 裡面對應的參數全部清掉。

-----------------------------------------------

稍微詳細一點的回答：


關於 session，可以想成是 PHP 對於每一個使用者都在 server side 都開一塊空間存
個人資料。你可以在 session 裡面放「這人登入的帳號是啥，權限是啥」...之類
的東西。因為在 server 上所以使用者碰不到，不能自己修改


寫資料進 $_SESSION 這個 super global 就等於是寫資料到 session 裡面。
如果 session 被啟用，這個變數裡面的資料會一直留著，直到 session 放太久過期

在使用他之前你需要呼叫 session_start()，除非機器有設定自動 session start



但是每個 HTTP request 都是等價的，我要怎麼知道哪個 request 是誰？

答案是 PHP 會發給每個人一個臨時身份 ID，也就是所謂的 session id。例如：

小明進站 -&gt; Server 發給小明 ID 是 1
小桃進站 -&gt; Server 發給小桃 ID 是 2

之後小明跟小桃的每一個 request 都會帶著 session id
server 只要看到 session id 是 1 就知道那是小明， 2 就是小桃，3 就是有人來亂...


session id 通常會放在 cookie 裡面，所以每次 request 都會自動帶給 server
這一段 PHP 會幫你做掉，你不用(也不該)自己對 cookie 動這一段手腳


當然，對於有能力的使用者他可以亂改 cookie 裡面的 session id
但是除非他知道其他人的 session id，不然他亂改只會讓自己被登出

另外，現實生活中的 session id 不會是 1/2/3，而是

ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng

這樣一大串，所以要猜也不是那麼好猜到，除非你面對的人超厲害...



假設你一切做對，那麼 cookie 裡面只會剩下一堆亂七八糟的ID
沒辦法從 cookie 裡面找到帳號密碼或權限...之類的資料

cookie 也不是完全不能用，只是以「登入」來說不該用...

-----------------------------------------------

這只是初階，更多 cookie 跟 session 的安全性討論可以看這篇文章
<a href="http://devco.re/blog/2014/06/03/http-session-protection/" target="_blank" rel="noreferrer noopener nofollow">http://devco.re/blog/2014/06/03/http-session-protection/</a>

如果看不懂...就...表示你還沒有能力擔心到這塊，慢慢學吧...

--
莉娜用魔法爆破進入屋內。
劫犯從另一個房間裡出現，大叫道︰「妳是誰！」
莉娜︰「我是個可疑的女人！」
劫犯無言以對。

--
<span class="f2">※ 發信站: 批踢踢實業坊(ptt.cc), 來自: 60.248.122.206
</span><span class="f2">※ 文章網址: <a href="https://www.ptt.cc/bbs/PHP/M.1464160732.A.262.html" target="_blank" rel="noreferrer noopener nofollow">https://www.ptt.cc/bbs/PHP/M.1464160732.A.262.html</a>
</span><span class="f2">※ 編輯: GALINE (60.248.122.206), 05/25/2016 15:19:37
</span><span class="f2">※ 編輯: GALINE (60.248.122.206), 05/25/2016 15:21:16
</span><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">Neisseria</span><span class="f3 push-content">: 推</span><span class="push-ipdatetime"> 05/25 15:21
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">shadowjohn</span><span class="f3 push-content">: 下一步就多站台共享session path、memory share...</span><span class="push-ipdatetime"> 05/25 15:27
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">wilson200106</span><span class="f3 push-content">: 下一步Redis(咦</span><span class="push-ipdatetime"> 05/25 15:48
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">shadowjohn</span><span class="f3 push-content">: 應該是又全部打掉重寫，然後又換別人問這個問題XD</span><span class="push-ipdatetime"> 05/25 16:25
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">GALINE</span><span class="f3 push-content">: Redis 好用，不過 scale out 很麻煩...</span><span class="push-ipdatetime"> 05/25 16:28
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">HwangTW</span><span class="f3 push-content">: 謝謝指教</span><span class="push-ipdatetime"> 05/25 16:57
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">LMGG</span><span class="f3 push-content">: 認真講解給推</span><span class="push-ipdatetime"> 05/25 20:59
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">GuYueHu</span><span class="f3 push-content">: 請問通常用session作帳號登入的部份會設timer嗎</span><span class="push-ipdatetime"> 05/27 08:51
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">GuYueHu</span><span class="f3 push-content">: 還是放到session自動timeout? 這樣會有安全疑慮嗎</span><span class="push-ipdatetime"> 05/27 08:51
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">GALINE</span><span class="f3 push-content">: 看...需求？我是一下沒想到什麼情況會需要登入跟session</span><span class="push-ipdatetime"> 05/27 12:46
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">GALINE</span><span class="f3 push-content">: 的 timeout 時間要不一樣就是了</span><span class="push-ipdatetime"> 05/27 12:46
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">j355066</span><span class="f3 push-content">: 推</span><span class="push-ipdatetime"> 05/27 14:55
</span></div><div class="push"><span class="hl push-tag">推 </span><span class="f3 hl push-userid">imhaha</span><span class="f3 push-content">: 借問一下～cookie可以個別設定到期的時間，session似乎沒</span><span class="push-ipdatetime"> 05/28 01:53
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">imhaha</span><span class="f3 push-content">: 辦法做到這點，只能全數清除對吧(？</span><span class="push-ipdatetime"> 05/28 01:53
</span></div><div class="push"><span class="f1 hl push-tag">→ </span><span class="f3 hl push-userid">GALINE</span><span class="f3 push-content">: 有「自己紀錄expire time」這招，每次讀值都檢查一次...</span><span class="push-ipdatetime"> 05/30 11:05
</span></div></div>
    
    <div id="article-polling" data-pollurl="/poll/PHP/M.1464160732.A.262.html?cacheKey=2148-469784939&amp;offset=3980&amp;offset-sig=8246b086553c038b1bee764f572f2cada486b9d0" data-longpollurl="/v1/longpoll?id=6b2c99313420e14dae5e91447689a5d5735b6768" data-offset="3980"></div>
    

    
</div>

		

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32365737-1', {
    cookieDomain: 'ptt.cc',
    legacyCookieDomain: 'ptt.cc'
  });
  ga('send', 'pageview');
</script>


		
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="//images.ptt.cc/bbs/v2.27/bbs.js"></script>

    <script type="text/javascript">(function(){window['__CF$cv$params']={r:'710ceac64c28807e',m:'TxEfwZz0Pgo6W0T81WVWFbxHzTazSodaZ3GYQ3z7jT0-1653467510-0-AY3V9EWSH6pnUB7pwt/BKyvTJ1DrWQpDck/CyMGP3MWuTsqCWgrDAU6H8CRVSJDOdQEHyFbGHahSUBUcv3CygSbDUzj3ylUqHvD8ge6LMntL/E04Wh/Wnh5Cs+BgrQKLOed6CU6+VCiNWE7BOr0Bft8pVQPPQ/Nu+s8UFINyDGlE',s:[0xa39fa33cd8,0x69992271d2],u:'/cdn-cgi/challenge-platform/h/g'}})();</script></body>
</html>
